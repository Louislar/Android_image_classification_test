# 離線Android語音進度日誌

## 主要開發環境為ubuntu

## 2019/09/09

- 下載pre-trained的model看能不能用（下載完成）
- 包含兩種檔案
    - model檔案，存放資料夾：home/preTrainedModel
    - 測試用的聲音檔案，存放資料夾：home/exampleAudioFile
- 下載完成後測試使用預測沒有問題
    - 使用自己的聲音檔預測過，預測結果不准，可能是我的發音問題
    - 會預測出音很像的單字
    - 如下圖預測結果
    - ![image](https://raw.githubusercontent.com/Louislar/Android_tensorflow_speechRecognition/master/Screenshot%20from%202019-09-09%2019-54-51.png)
- 已經將檔案傳送到server上面，等待執行/訓練模型
    - 在安裝需求套時遇到困難，
    - 不知道只安裝沒安裝過得套件的指令是啥？
    - 只好一個一個安裝 （完成）
- 下載完成中文的開放語料
    - mozilla提供
    - 存放於資料夾：mandarin_dataset/zh-TW

- 下載完成pre-trained model的check point檔案
    - 存放資料夾： /home/wmlab/deepvoice/preTrainedModel/deepspeech-0.5.1-checkpoint
    - 試試轉成tflite?
- 接下來的任務
    - 先確認英文的pre-trained model可以轉換成tflite的model
        - 猜測要下載check point的檔案才能轉換為tflite model
    - 使用下載的中文語料做訓練

## 2019/09/10

- 下午先休息，晚上在考慮來做 （今天先做備審資料，以及中研院的資料清理）


## 2019/09/11

- 想使用android-speech專案來做(https://github.com/mozilla/androidspeech/)

- 看到此issue建議將android-speech的程式碼看完(https://github.com/mozilla/DeepSpeech/issues/2229)
- 此issue也是問android問題(https://github.com/mozilla/DeepSpeech/issues/2057)
- 要先安裝swig(https://david740204.pixnet.net/blog/post/429054062-ubuntu-%E5%AE%89%E8%A3%9Dswig)
- 要先安裝pcre(file:///home/wmlab/Downloads/swig-3.0.12/Doc/Manual/Preface.html)
- 以上兩個安裝是生產.so檔案的必備套件，目前還是沒辦法跑make apk，推測是沒有裝java
- 先嘗試將android-speech跑起來
    - 安裝gradle，使用 (http://blog.lyhdev.com/2013/01/ubuntu-linux-apt-get.html) 
    - 解決"Could not find method google() for arguments [] on repository container."問題： （https://www.jianshu.com/p/cb40bf3875d5）
    - 安裝sdk (輸入指令sudo apt update && sudo apt install android-sdk)
    -   放棄，使用adroid sudio試試看，也不行

- 返回使用deep speech的demo app但是遇到報錯無法解決，所以在論壇上發問,連結（https://discourse.mozilla.org/t/how-to-use-the-android-demo/44944）
    - 有人回覆要求提供環境資訊，已回傳開發環境資訊，等待對方再次回覆。
    - 目前已成功build出apk檔了,等回到學校後再用手機試試看。


## 2019/09/17

- 目前已經能使用Deep speech的APP了，使用的是WAV格式的16KHz檔案做預測
- 現在要研究如何錄音後可以轉成WAV檔案儲存，才能在Deep speech上做預測
    - 參考連結: 
    - google搜尋: android API 錄音 功能
    - https://www.cnblogs.com/tyjsjl/p/3695122.html
    - http://tw.gitbook.net/android/android_audio_capture.html
    - https://www.twblogs.net/a/5c39e9a7bd9eee35b21dada4
- 現在開始弄清楚如何將model轉成tflite格式
- 先弄清楚如何train自己的data
    - 訓練用的virtual environment已經安裝完成
    - 實際試用還未做
- 現在有兩個虛擬環境：
    - 1. deepspeech_venv: 使用pre-train model用的虛擬環境
    - 2. deepspeech-train-venv: 要自己train model用的虛擬環境

- 目前安裝了python3.6，目的是為了符合pre-train model用的虛擬環境
    - python3.6位置： /home/wmlab/Downloads/Python-3.6.3
    - 目前python3.6的環境裝不起來，不知道為啥？
- 目前放棄使用virtualenv，改用anacnoda
    - 要非常注意，在anaconda虛擬環境安裝東西時，一定要使用pip不要用pip3


## 2019/09/18

- 目前遇到不能執行測試指令的問題，不能執行：./bin/run-ldc93s1.sh
    - 解法： https://github.com/mozilla/DeepSpeech/issues/1199
    - https://github.com/mozilla/DeepSpeech/issues/1265
- 等待下載lm.binary(1.8G)
    - ![download so longgggggg...](https://raw.githubusercontent.com/Louislar/Android_tensorflow_speechRecognition/master/Screenshot%20from%202019-09-18%2018-59-56.png)

## 2019/09/22

- 下載lm.binary(1.8g)完成
- 繼續嘗試./bin/run-ldc93s1.sh指令
    - 成功圖片: ![image_success](https://raw.githubusercontent.com/Louislar/Android_tensorflow_speechRecognition/master/screenshot2019-09-23.png)
- 嘗試./DeepSpeech.py --train_files ../data/CV/en/clips/train.csv --dev_files ../data/CV/en/clips/dev.csv --test_files ../data/CV/en/clips/test.csv指令, 改成自己的中文語料位置訓練看看
    - 先重新執行bin/import_cv2.py --filter_alphabet path/to/some/alphabet.txt /path/to/extracted/language/archive
    - 必須要將data/alphabet.txt加上中文字執行: bin/import_cv2.py --filter_alphabet data/alphabet.txt /home/wmlab/deepvoice/mandarin_dataset/zh-TW

- 目前遇到問題, alphabet.txt可能要將中文字自己加入: ![image_error](https://raw.githubusercontent.com/Louislar/Android_tensorflow_speechRecognition/master/screenshot2019-09-23-12-54.png)


## 2019/09/23

- 下一步要訓練中文語料，可能會遇到的問題：
    - https://github.com/mozilla/DeepSpeech/pull/2117
    - https://discourse.mozilla.org/t/training-chinese-model/27769
    - https://discourse.mozilla.org/t/does-anyone-got-a-good-result-when-training-the-common-voice-data-set/24270


## 2019/09/30

- 更改完alphabet.txt(新增中文字)後, 就可以train了
- 注意!! 一定要更改checkpoint的folder才能train

